import requests
import time
import json


# # Base URL of the API
# BASE_URL = "http://202.142.159.38"

# # Helper function to send a POST request
# def send_request(endpoint, prompt):
#     url = f"{BASE_URL}:{endpoint['port']}/{endpoint['path']}"
#     payload = {"prompt": prompt}
#     headers = {"Content-Type": "application/json"}

#     # print(prompt)

    
#     start_time = time.time()
#     response = requests.post(url, json=payload, headers=headers )
#     end_time = time.time()
#     print("end")

    
#     if response.status_code == 200:

#         response_data = response.json()
#         response_data["time_taken"] = round(end_time - start_time, 2)
#         return response_data
#     else:
#         print(response.status_code)
#         return {"error": response.text, "status_code": response.status_code}
    

# def generate_topics(prompt):
#     endpoint = {"port": 5032, "path": "generate_topics"}
#     return send_request(endpoint, prompt)


# def generate_entities(prompt):
#     endpoint = {"port": 5031, "path": "generate_entity"}
#     return send_request(endpoint, prompt)



# # Function to generate both topics and entities
# def generate_topics_and_entities(prompt):
#     """
#     Generates both topics and entities from the given prompt using the API.
    
#     Args:
#         prompt (str): The input text for generating both topics and entities.
        
#     Returns:
#         dict: The response from the API for generating topics and entities.
#     """
#     endpoint = {"port": 5028, "path": "generate_topics_entity"}
#     return send_request(endpoint, prompt)

# # Main function to demonstrate the API usage
# def main():
#     urdu_text = "Total files: 1 Audio File Name: ARY_News_9_PM_Prime_Time_Headlines_31st_July_2024_ Audio File Duration: 00:19:39 Published Date: 2024-07-30 حماس سربراہ اسماعیل ہنیہ ایران میں شہید کر دیے گئے تہران میں مہمان آئے اسماعیل ہنیہ کو میزائل حملے میں شہید کیا گیا ترانی میڈیا کے مطابق رات دو بجے کسی اور ملک سے میزائل داغا گیا اسماعیل ہنیہ سابق فوجیوں کے ہیڈ کوارٹرز میں مقیم تھے ہنیہ کا ساتھی بھی ہوا میں شہید اسماعیل ہنیہ ایرانی صدر کی تقریب حلف برداری میں شریک ہونے آئے تھے ایرانی سپریم لیڈر آیت ﷲ خامنہ ای کہتے ہیں اسماعیل ہنیہ کو ہماری سرزمین پر ختم کیا گیا بدلہ لینا ایران پر فرض ہے دہشت گرد سعودی حکومت نے ہمیں اس کو سخت سزا دینے کی بنیاد فراہم کر دی گرانی صدر مسعود بیان میں کہا بزدلانہ اس حملے کا حساب دینا پڑے گا دینار اپنی سالمیت اور عزت کا دفاع کرے گا دہشت گرد حملہ آور اپنے بزدلانہ اقدام پر پچھتائیں گے مہمان کے قتل پر کو میں انتقام کی علامت سرخ پرچم لہرا دیا گیا اسماعیل ہنیہ کی نماز جنازہ کل تہران میں ادا کی جائے گی تدفین جمعے کو دوحہ میں ہو گی اسماعیل ہنیہ کے قتل کا اعتراف اسرائیلی حکومت کے پریس آفس نے سوشل میڈیا پوسٹ کی جس میں اسماعیل ہانیہ کی تصویر پر ایلیمنیٹ لکھا تھا کچھ دیر بعد پوسٹ ڈیلیٹ کر دی گئی امریکی وزیرخارجہ لنکن کہتے ہیں حماس رہنما کو شاہراہ بنانے میں امریکا ملوث نہیں اسماعیل ہانیہ کی موت کے بعد غزا جنگ بندی لازمی ہے امریکا کو حملے سے متعلق کوئی اطلاعات نہیں تھیں مذاکرات جاری رکھنے کے ﻿لیے ہر ممکن کوشش کریں گے امریکی وزیر دفاع لائیڈ آسٹن نے کہا اسماعیل ہنیہ کے قتل کے بعد خطے میں جنگ کے امکانات بڑھ گئے ہیں اسرائیل پر حملہ کیا گیا تو امریکا اس کا دفاع کرے گا انہوں نے مجرم نے فوراً ملک کے اندر قوانین کو مل رہی ہے پورے مسلمان ہو گیا ہے نیچے آ رہا ہے اس کو اناؤنس کر دیا ہے کہ کا دن منایا جائے گا اسماعیل ہنیہ کو اسرائیلی ایجنٹ نے نشانہ بنایا اس کی سزا دی جائے گی حماس کا اعلان ترجمان خالد قدومی نے اے آر وائے نیوز سے گفتگو میں کہا اسرائیل نے اسماعیلیہ نہیں تمام مسلمانوں پر حملہ کیا ہم حالت جنگ میں اپنا دفاع کر رہے ہیں مسلم امہ کو حملے کا منہ توڑ جواب دینا چاہیے حزب ﷲ نے کہا اس سمائل ہنڈیا کی شہادت سے مزاحمتی گروپس کو مزید تقویت ملے گی فلسطینی صدر محمود عباس نے اسماعیل ہنیہ کا قتل بزدلانہ عمل قرار دے دیا اسماعیل ہنیہ کی شہادت پر مغربی کنارے میں سوگ کا عالم بڑے پیمانے پر مظاہرے ل لا نا اب لے سر ہے ان میں ہزاروں فلسطینیوں کا سڑکوں پر مارچ اسماعیل ہنیہ کے اہل خانہ نے ان کی شہادت کو باعث فخر قرار دیا بیچے عبدالسلام ہانیہ نے کہا والد ہر روز شہادت محسوس کرتے تھے ہمیں ان پر فخر ہے اور ہم اپنا سر اونچا رکھنے کے والد کی وہ آرزو پوری ہوئی جس کا انہوں نے خواب دیکھا تھا اس واہی کی بہو نے ویڈیو پیغام میں کہا آج میرے سسر شہیدوں میں شامل ہو گئے غم بہت بڑا ہے آنکھیں اشکبار ہیں دل غمزدہ ہے لیکن امید ہے خدا ہماری قسمت بدل دے گا اور ہمیں بہتر حالات پر بات کرے گا فراق میں اسماعیل ہنیہ کا قتل پاکستان کی شدید مذمت ترجمان دفترخارجہ نے کہا ہر قسم کی دہشت گردی ناقابل قبول ہے پاکستان کو خطے میں بڑھتی اس جاہلی مہم جوئی پر گہری تشویش ہے ترک صدر طیب اردوان نے کہا پھر ثابت ہوا نیتھن یاہو ایسے نہیں چاہتا حملے کا مقصد فلسطینیوں کے حوصلے پست کرنا ہے صحیح نہیں ہے اپنے مقاصد میں کامیاب نہیں ہوں گے قطر کے وزیراعظم شیخ محمد بن عبدالرحمن الثانی نے کہا کہ حنفیہ کی شہادت سے غزا جنگ بندی مذاکرات کھٹائی میں پڑ گئے ایک فریق دوسرے مذاکرات کار کو قتل کر دے تو سال سے کیسے کامیاب ہو سکتی ہے چینی وزارت خارجہ کا کہنا ہے یہ واقعہ مزید عدم استحکام کا باعث بن سکتا ہے کشیدگی سے بچنے کے ﻿لیے فوری جنگ بندی ہونی چاہیے روس نے اسماعیل ہنیہ کی شہادت ناقابل قبول سیاسی جرم قرار دے دیا افغانستان نے بھی اسماعیل ہانیہ پر حملے کی مذمت کر دی دنیا بھر میں اسماعیل ہانیہ کی غائبانہ نماز جنازہ ان کا راہ میں شہید کو سلام پیش کرنے ہزاروں افراد سڑکوں پر نکلے پاکستانیوں کا بھی فلسطینی مجاہد کو خراج عقیدت مختلف شہروں میں غائبانہ نماز جنازہ ادا کی گئی کراچی میں نیو ایم اے جناح روڈ پر جماعت اسلامی کے زیر اہتمام اسماعیل ہانیہ کی غائبانہ نما جنازہ ادا کی گئی جس میں شہری فلسطینی پرچم تھام کر شریک ہوئے شرکاء نے شہید اسماعیل ہنیہ کو زبردست خراج عقیدت پیش کیا لاہور میں نماز جنازہ کے بعد شرکاء نے اسرائیلی دہشت گردی کے خلاف نعرے لگائے شرکاء کا کہنا تھا کہ اسماعیل ہانیہ کی شہادت کے پیچھے امریکا اور اسرائیل ہم مظلوم فلسطینیوں کے شانہ بشانہ کھڑے ہیں پشاور اور کوئٹہ سمیت دیگر شہروں میں بھی نماز ہے جنازہ ادا کی گئی اسرائیل نے جو دہشتگردی کی اس کے نتیجے میں یہ سمجھتا ہے کہ حماس کی اس تحریک کو روک سکتے ہیں تو اس کی خام خیالی ہے ایک اسماعیل ہنیہ کو شہید کر کے علاقوں اسماعیل دنیا پوری دنیا میں اور فلسطین میں پیدا ہو یا مزاحمتی تحریک رکے گی ایک اسماعیل ہنیہ کی شہادت لاکھوں اسماعیل ہنیہ پیدا کریں کی ہے امیر جماعت اسلامی حافظ نعیم الرحمن نے کہا ہم بھی کا اسٹائل کو ہر قسم کی مدد فراہم کر رہا ہے فلسطینی بھائیوں کو پیغام ہے کہ پاکستانی ان کے ساتھ ہیں جے یو آئی ف کا اسماعیل ہنیہ کی شہادت پر جمعہ کو ملک گیر احتجاج کا اعلان مولانا فضل الرحمن کہتے ہیں اسماعیل ہنیہ کی شہادت سے فلسطین کی آزادی کی تحریک ختم نہیں ہو گی نائب صدر پیپلز پارٹی شیری رحمن نے حماس رہنما اسماعیل ہنیہ کے قتل کی مذمت کر دی کہا اسرائیل نے پیغام دیا ہے کہ اسے کوئی روک نہیں سکتا اسرائیل جنگ کو روکنے کے"
#     print("Generating topics...")
#     topics_response = generate_topics(urdu_text)
#     print("Response for Topics:", topics_response)
    
#     # print("\nGenerating entities...")
#     # entities_response = generate_entities(urdu_text)
#     # print("Response for Entities:", entities_response)
    
#     # print("\nGenerating both topics and entities...")
#     # both_response = generate_topics_and_entities(urdu_text)
#     # print("Response for Both:", both_response)

# # Run the main function
# if __name__ == "__main__":
#     main()

BASE_URL = "https://0332-34-118-204-69.ngrok-free.app"

def format_topics(result):
    topics = {}
    
    for idx, line in enumerate(result, start=1):

        topics[f"topic{idx}"] = {
            "content": line,
            "entity": ""
        }

    return topics

def extract_result(api_response):
    """Extract result from the API response."""
    if "result" not in api_response:
        return "Error: 'result' not found in the response."
    result = api_response["result"]

    if isinstance(result, list) and len(result) > 0:
        for item in result:
            if item["role"] == "assistant":
                content = item["content"]
                if "\n" not in content:
                    return content.strip()

        # If content contains multiple lines, return as a list of topics
        for item in result:
            if item["role"] == "assistant":
                content = item["content"]
                topics = [line.strip() for line in content.split("\n") if line.strip()]
                return topics

    return "Error: Unable to parse response."

def generate_entity1(result):
    print(result)
    for res in result:
        generated_entity = generate_entity(result[res]['content'])
        result[res]['entity'] = generated_entity
    print(result)

    return result

def generate_entity(text):
    """Generate entities from the provided text."""
    payload = {"text": text}
    try:
        response = requests.post(f"{BASE_URL}/generate_entity", json=payload)
        response.raise_for_status()  # Raise HTTPError for bad responses (4xx and 5xx)
        api_response = response.json()
        return extract_result(api_response)
    except requests.exceptions.RequestException as e:
        return f"Error: {e}"

def generate_topics(text):
    """Generate topics from the provided text."""
    payload = {"text": text}
    try:
        response = requests.post(f"{BASE_URL}/generate_topics", json=payload)
        response.raise_for_status()  # Raise HTTPError for bad responses (4xx and 5xx)
        api_response = response.json()
        return extract_result(api_response)
    except requests.exceptions.RequestException as e:
        return f"Error: {e}"
    
def generate_topic_entity(urdu_text):
    topics = generate_topics(urdu_text)
    topics = format_topics(topics)
    result = generate_entity1(topics)
    print("Extracted Entity:", result)
    return result


# # Example usage
# if __name__ == "__main__":

#     urdu_text = "Total files: 1 Audio File Name: ARY_News_9_PM_Prime_Time_Headlines_31st_July_2024_ Audio File Duration: 00:19:39 Published Date: 2024-07-30 حماس سربراہ اسماعیل ہنیہ ایران میں شہید کر دیے گئے تہران میں مہمان آئے اسماعیل ہنیہ کو میزائل حملے میں شہید کیا گیا ترانی میڈیا کے مطابق رات دو بجے کسی اور ملک سے میزائل داغا گیا اسماعیل ہنیہ سابق فوجیوں کے ہیڈ کوارٹرز میں مقیم تھے ہنیہ کا ساتھی بھی ہوا میں شہید اسماعیل ہنیہ ایرانی صدر کی تقریب حلف برداری میں شریک ہونے آئے تھے ایرانی سپریم لیڈر آیت ﷲ خامنہ ای کہتے ہیں اسماعیل ہنیہ کو ہماری سرزمین پر ختم کیا گیا بدلہ لینا ایران پر فرض ہے دہشت گرد سعودی حکومت نے ہمیں اس کو سخت سزا دینے کی بنیاد فراہم کر دی گرانی صدر مسعود بیان میں کہا بزدلانہ اس حملے کا حساب دینا پڑے گا دینار اپنی سالمیت اور عزت کا دفاع کرے گا دہشت گرد حملہ آور اپنے بزدلانہ اقدام پر پچھتائیں گے مہمان کے قتل پر کو میں انتقام کی علامت سرخ پرچم لہرا دیا گیا اسماعیل ہنیہ کی نماز جنازہ کل تہران میں ادا کی جائے گی تدفین جمعے کو دوحہ میں ہو گی اسماعیل ہنیہ کے قتل کا اعتراف اسرائیلی حکومت کے پریس آفس نے سوشل میڈیا پوسٹ کی جس میں اسماعیل ہانیہ کی تصویر پر ایلیمنیٹ لکھا تھا کچھ دیر بعد پوسٹ ڈیلیٹ کر دی گئی امریکی وزیرخارجہ لنکن کہتے ہیں حماس رہنما کو شاہراہ بنانے میں امریکا ملوث نہیں اسماعیل ہانیہ کی موت کے بعد غزا جنگ بندی لازمی ہے امریکا کو حملے سے متعلق کوئی اطلاعات نہیں تھیں مذاکرات جاری رکھنے کے ﻿لیے ہر ممکن کوشش کریں گے امریکی وزیر دفاع لائیڈ آسٹن نے کہا اسماعیل ہنیہ کے قتل کے بعد خطے میں جنگ کے امکانات بڑھ گئے ہیں اسرائیل پر حملہ کیا گیا تو امریکا اس کا دفاع کرے گا انہوں نے مجرم نے فوراً ملک کے اندر قوانین کو مل رہی ہے پورے مسلمان ہو گیا ہے نیچے آ رہا ہے اس کو اناؤنس کر دیا ہے کہ کا دن منایا جائے گا اسماعیل ہنیہ کو اسرائیلی ایجنٹ نے نشانہ بنایا اس کی سزا دی جائے گی حماس کا اعلان ترجمان خالد قدومی نے اے آر وائے نیوز سے گفتگو میں کہا اسرائیل نے اسماعیلیہ نہیں تمام مسلمانوں پر حملہ کیا ہم حالت جنگ میں اپنا دفاع کر رہے ہیں مسلم امہ کو حملے کا منہ توڑ جواب دینا چاہیے حزب ﷲ نے کہا اس سمائل ہنڈیا کی شہادت سے مزاحمتی گروپس کو مزید تقویت ملے گی فلسطینی صدر محمود عباس نے اسماعیل ہنیہ کا قتل بزدلانہ عمل قرار دے دیا اسماعیل ہنیہ کی شہادت پر مغربی کنارے میں سوگ کا عالم بڑے پیمانے پر مظاہرے ل لا نا اب لے سر ہے ان میں ہزاروں فلسطینیوں کا سڑکوں پر مارچ اسماعیل ہنیہ کے اہل خانہ نے ان کی شہادت کو باعث فخر قرار دیا بیچے عبدالسلام ہانیہ نے کہا والد ہر روز شہادت محسوس کرتے تھے ہمیں ان پر فخر ہے اور ہم اپنا سر اونچا رکھنے کے والد کی وہ آرزو پوری ہوئی جس کا انہوں نے خواب دیکھا تھا اس واہی کی بہو نے ویڈیو پیغام میں کہا آج میرے سسر شہیدوں میں شامل ہو گئے غم بہت بڑا ہے آنکھیں اشکبار ہیں دل غمزدہ ہے لیکن امید ہے خدا ہماری قسمت بدل دے گا اور ہمیں بہتر حالات پر بات کرے گا فراق میں اسماعیل ہنیہ کا قتل پاکستان کی شدید مذمت ترجمان دفترخارجہ نے کہا ہر قسم کی دہشت گردی ناقابل قبول ہے پاکستان کو خطے میں بڑھتی اس جاہلی مہم جوئی پر گہری تشویش ہے ترک صدر طیب اردوان نے کہا پھر ثابت ہوا نیتھن یاہو ایسے نہیں چاہتا حملے کا مقصد فلسطینیوں کے حوصلے پست کرنا ہے صحیح نہیں ہے اپنے مقاصد میں کامیاب نہیں ہوں گے قطر کے وزیراعظم شیخ محمد بن عبدالرحمن الثانی نے کہا کہ حنفیہ کی شہادت سے غزا جنگ بندی مذاکرات کھٹائی میں پڑ گئے ایک فریق دوسرے مذاکرات کار کو قتل کر دے تو سال سے کیسے کامیاب ہو سکتی ہے چینی وزارت خارجہ کا کہنا ہے یہ واقعہ مزید عدم استحکام کا باعث بن سکتا ہے کشیدگی سے بچنے کے ﻿لیے فوری جنگ بندی ہونی چاہیے روس نے اسماعیل ہنیہ کی شہادت ناقابل قبول سیاسی جرم قرار دے دیا افغانستان نے بھی اسماعیل ہانیہ پر حملے کی مذمت کر دی دنیا بھر میں اسماعیل ہانیہ کی غائبانہ نماز جنازہ ان کا راہ میں شہید کو سلام پیش کرنے ہزاروں افراد سڑکوں پر نکلے پاکستانیوں کا بھی فلسطینی مجاہد کو خراج عقیدت مختلف شہروں میں غائبانہ نماز جنازہ ادا کی گئی کراچی میں نیو ایم اے جناح روڈ پر جماعت اسلامی کے زیر اہتمام اسماعیل ہانیہ کی غائبانہ نما جنازہ ادا کی گئی جس میں شہری فلسطینی پرچم تھام کر شریک ہوئے شرکاء نے شہید اسماعیل ہنیہ کو زبردست خراج عقیدت پیش کیا لاہور میں نماز جنازہ کے بعد شرکاء نے اسرائیلی دہشت گردی کے خلاف نعرے لگائے شرکاء کا کہنا تھا کہ اسماعیل ہانیہ کی شہادت کے پیچھے امریکا اور اسرائیل ہم مظلوم فلسطینیوں کے شانہ بشانہ کھڑے ہیں پشاور اور کوئٹہ سمیت دیگر شہروں میں بھی نماز ہے جنازہ ادا کی گئی اسرائیل نے جو دہشتگردی کی اس کے نتیجے میں یہ سمجھتا ہے کہ حماس کی اس تحریک کو روک سکتے ہیں تو اس کی خام خیالی ہے ایک اسماعیل ہنیہ کو شہید کر کے علاقوں اسماعیل دنیا پوری دنیا میں اور فلسطین میں پیدا ہو یا مزاحمتی تحریک رکے گی ایک اسماعیل ہنیہ کی شہادت لاکھوں اسماعیل ہنیہ پیدا کریں کی ہے امیر جماعت اسلامی حافظ نعیم الرحمن نے کہا ہم بھی کا اسٹائل کو ہر قسم کی مدد فراہم کر رہا ہے فلسطینی بھائیوں کو پیغام ہے کہ پاکستانی ان کے ساتھ ہیں جے یو آئی ف کا اسماعیل ہنیہ کی شہادت پر جمعہ کو ملک گیر احتجاج کا اعلان مولانا فضل الرحمن کہتے ہیں اسماعیل ہنیہ کی شہادت سے فلسطین کی آزادی کی تحریک ختم نہیں ہو گی نائب صدر پیپلز پارٹی شیری رحمن نے حماس رہنما اسماعیل ہنیہ کے قتل کی مذمت کر دی کہا اسرائیل نے پیغام دیا ہے کہ اسے کوئی روک نہیں سکتا اسرائیل جنگ کو روکنے کے"

#     topics = generate_topics(urdu_text)
#     topics = format_topics(topics)
#     print("Extracted Topics:", topics)

#     entity = generate_entity1(topics)
#     print("Extracted Entity:", entity)
